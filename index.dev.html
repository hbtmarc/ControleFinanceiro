<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#3b82f6">
    <title>Fluxo Financeiro</title>

    <!-- Firebase CDN Scripts (v10 Modular Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <!-- Critical CSS inline -->
    <style>body{font-family:'Inter',sans-serif;background:#f8f8fa;margin:0;padding:0}#loginScreen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;align-items:center;justify-content:center;z-index:999999}</style>
    
    <!-- Development CSS (Non-minified) -->
    <link rel="stylesheet" href="src/css/style.css">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com" defer></script>
    
    <!-- Lazy Load Chart.js -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" as="script">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" media="print" onload="this.media='all'">
    
    <!-- Lazy Load Libraries -->
    <script>
        window.addEventListener('load', () => {
            const scripts = [
                'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js',
                'https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns',
                'https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js',
                'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js'
            ];
            scripts.forEach(src => {
                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                document.body.appendChild(script);
            });
        });
    </script>

    
    
    
    
</head>
<body class="antialiased">
    <!-- Tela de Login -->
    <div id="loginScreen">
        <div class="login-container">
            <h1 class="login-title">Fluxo Financeiro</h1>
            <p class="login-subtitle">Entre com suas credenciais Firebase</p>
            <div class="login-error" id="loginError" style="display: none;">Erro ao fazer login</div>
            <input 
                type="email" 
                id="loginEmail" 
                class="login-input" 
                placeholder="Email"
                autocomplete="email"
            />
            <input 
                type="password" 
                id="loginPassword" 
                class="login-input" 
                placeholder="Senha"
                autocomplete="current-password"
            />
            <button id="loginBtn" class="login-btn">Entrar</button>
        </div>
    </div>

    <!-- aplicaï¿½ï¿½o Principal -->
    <div id="mainApp">
    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Cabeï¿½alho (compact) -->
        <header class="flex flex-col sm:flex-row items-center justify-between mb-6 gap-2">
            <div class="flex items-center gap-1">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                    <span>Fluxo Financeiro</span>
                </h1>
                <div id="desktop-quick-links" class="inline-flex items-center gap-1 ml-1">
                    <button id="desktop-dashboard-btn" class="bg-white/80 p-2 rounded-full shadow-sm  " title="Dashboard">
                        <span class="material-symbols-outlined text-gray-600">dashboard</span>
                    </button>
                    <button id="desktop-creditcards-btn" class="bg-white/80 p-2 rounded-full shadow-sm  " title="Cartï¿½es">
                        <span class="material-symbols-outlined text-gray-600">credit_card</span>
                    </button>
                    <button id="add-transaction-btn" class="bg-blue-600 p-2 rounded-full shadow-sm   text-white ml-1" title="Nova transaï¿½ï¿½o">
                        <span class="material-symbols-outlined">add</span>
                    </button>
                    <button id="logoutBtn" class="bg-red-500 p-2 rounded-full shadow-sm   text-white ml-1" title="Sair">
                        <span class="material-symbols-outlined">logout</span>
                    </button>
                </div>
                <!-- VR KPI moved to right column (below 'Projetado' and above feedback) -->
            </div>
          <div class="flex items-center gap-2">
              <div class="flex items-center gap-2">
                    <div id="infrequent-controls" class="infrequent-controls flex items-center gap-1">
                        <button id="import-data-btn" class="bg-white/80 p-2 rounded-full shadow-sm  " title="Importar dados (JSON)">
                            <span class="material-symbols-outlined text-gray-600">upload</span>
                        </button>
                        <button id="create-backup-btn" class="bg-white/80 p-2 rounded-full shadow-sm  " title="Criar backup completo" aria-label="Criar backup">
                            <span class="material-symbols-outlined text-gray-600">save</span>
                        </button>
                        <button id="restore-backup-btn" class="bg-white/80 p-2 rounded-full shadow-sm  " title="Restaurar backup" aria-label="Restaurar backup">
                            <span class="material-symbols-outlined text-gray-600">restore_from_trash</span>
                        </button>
                        <button id="export-data-btn" class="bg-white/80 p-2 rounded-full shadow-sm  " title="Exportar dados (JSON)">
                            <span class="material-symbols-outlined text-gray-600">download</span>
                        </button>
                    </div>
                    <input type="file" id="import-file-input" class="hidden" accept=".json">
                    <!-- Mobile toggle for import/export (visible on small screens) -->
                    <button id="mobile-infrequent-toggle" class="bg-white/80 p-2 rounded-full shadow-sm   hidden sm:inline-flex" title="Mais opï¿½ï¿½ES" aria-label="Abrir opï¿½ï¿½ES">
                        <span class="material-symbols-outlined text-gray-600">more_horiz</span>
                    </button>
                    <button id="monthly-report-btn" class="bg-white/80 p-2 rounded-full shadow-sm  " title="RelaTï¿½ï¿½rio Mensal" aria-label="RelaTï¿½ï¿½rio Mensal">
                        <span class="material-symbols-outlined text-gray-600">assessment</span>
                    </button>
                     <button id="annual-report-btn" class="bg-white/80 p-2 rounded-full shadow-sm  " title="RelaTï¿½ï¿½rio Anual" aria-label="RelaTï¿½ï¿½rio Anual">
                        <span class="material-symbols-outlined text-gray-600">calendar_month</span>
                    </button>
                    <!-- quick links removed from this position (moved next to title) -->
                </div>
                <!-- Backup / Restore Modal (hidden by default) -->
                <dialog id="backup-restore-modal" class="p-4 rounded-2xl shadow-2xl card w-full max-w-3xl">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold">Gerenciar Backups</h3>
                        <button id="close-backup-modal" class="px-2 py-1 rounded bg-gray-100">Fechar</button>
                    </div>
                    <div class="flex gap-4">
                        <div style="flex:1;min-width:260px;max-width:420px;">
                            <div class="flex items-center justify-between mb-2">
                                <strong>Backups</strong>
                                <button id="refresh-backups-btn" class="px-2 py-0.5 rounded bg-gray-100 text-sm">Atualizar</button>
                            </div>
                            <div id="backups-list" style="max-height:420px;overflow:auto;border:1px solid rgba(0,0,0,0.04);padding:8px;border-radius:8px;">
                                <div class="text-sm text-gray-500">Nenhum backup encontrado.</div>
                            </div>
                        </div>
                        <div style="flex:1;min-width:320px;">
                            <div class="flex items-center justify-between mb-2">
                                <strong>Preview</strong>
                                <div>
                                    <button id="download-preview-btn" class="px-2 py-0.5 rounded bg-gray-100 text-sm">Baixar</button>
                                    <button id="delete-backup-btn" class="px-2 py-0.5 ml-2 rounded bg-red-100 text-red-700 text-sm " title="Excluir backup permanentemente">Excluir</button>
                                    <button id="restore-selected-btn" class="px-2 py-0.5 ml-2 rounded bg-red-600 text-white text-sm">Restaurar</button>
                                </div>
                            </div>
                            <div id="backup-preview" style="max-height:420px;overflow:auto;border:1px solid rgba(0,0,0,0.04);padding:8px;border-radius:8px;background:#fff"></div>
                        </div>
                    </div>
                </dialog>
                <!-- Import JSON Modal -->
                <dialog id="import-json-modal" class="p-4 rounded-2xl shadow-2xl card w-full max-w-3xl">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold">Importar Dados (.json)</h3>
                        <button id="close-import-modal" class="px-2 py-1 rounded bg-gray-100">Fechar</button>
                    </div>
                    <div class="space-y-3">
                        <p class="text-sm text-gray-600">Selecione um arquivo <strong>.json</strong> exportado pelo aplicativo. O arquivo pode conter o objeto principal <code>financeAppDB_v10</code> ou diretamente a estrutura de dados da aplicaï¿½ï¿½o. O processo irï¿½ substituir os dados locais.</p>
                        <div class="flex gap-4">
                            <div style="flex:1;min-width:260px;max-width:420px;">
                                <label class="block text-sm font-medium mb-1">Arquivo (.json)</label>
                                <input type="file" id="import-file-input-modal" accept=".json,application/json" class="w-full border rounded p-2" />
                                <div id="import-file-info" class="text-xs text-gray-500 mt-2">Nenhum arquivo selecionado.</div>
                                <div class="mt-3">
                                    <button id="parse-import-btn" class="px-3 py-1 rounded bg-blue-600 text-white">Ler e Validar</button>
                                    <button id="clear-import-btn" class="px-3 py-1 ml-2 rounded bg-gray-100">Limpar</button>
                                </div>
                            </div>
                            <div style="flex:1;min-width:320px;">
                                <label class="block text-sm font-medium mb-1">Preview / Validaï¿½ï¿½o</label>
                                <div id="import-preview" style="max-height:420px;overflow:auto;border:1px solid rgba(0,0,0,0.04);padding:8px;border-radius:8px;background:#fff;font-family:monospace;font-size:12px;white-space:pre-wrap;">Nenhum preview disponï¿½ï¿½vel.</div>
                            </div>
                        </div>
                        <div class="flex justify-end gap-2">
                            <button id="import-cancel-btn" class="px-3 py-1 rounded bg-gray-100">Cancelar</button>
                            <button id="import-confirm-btn" class="px-3 py-1 rounded bg-red-600 text-white" disabled>Importar e Substituir</button>
                        </div>
                    </div>
                </dialog>
                <div class="flex items-center gap-1 card !shadow-sm  rounded-full p-0.5">
                    <button id="prev-month-btn" class="p-1.5 rounded-full   ">
                        <span class="material-symbols-outlined">chevron_left</span>
                    </button>
                    <div class="relative">
                        <span id="current-month-display" class="w-36 text-center font-semibold text-gray-700 whitespace-nowrap cursor-pointer text-sm">Setembro 2025</span>
                        <!-- Month picker popover (hidden by default) -->
                        <div id="month-picker" class="hidden absolute z-50 mt-2 right-0 w-56 bg-white rounded-lg shadow-lg border border-gray-200 p-3">
                            <div class="space-y-2">
                                <label class="block text-xs text-gray-500">Mï¿½s</label>
                                <select id="month-picker-month" class="w-full border-gray-200 rounded-md p-1 text-sm">
                                    <option value="0">Janeiro</option>
                                    <option value="1">Fevereiro</option>
                                    <option value="2">Marï¿½o</option>
                                    <option value="3">Abril</option>
                                    <option value="4">Maio</option>
                                    <option value="5">Junho</option>
                                    <option value="6">Julho</option>
                                    <option value="7">Agosto</option>
                                    <option value="8">Setembro</option>
                                    <option value="9">Outubro</option>
                                    <option value="10">Novembro</option>
                                    <option value="11">Dezembro</option>
                                </select>
                                <label class="block text-xs text-gray-500">Ano</label>
                                <select id="month-picker-year" class="w-full border-gray-200 rounded-md p-1 text-sm"></select>
                                <div class="flex justify-end gap-2 pt-2">
                                    <button id="month-picker-cancel" type="button" class="px-3 py-1 text-sm rounded bg-gray-100 ">Cancelar</button>
                                    <button id="month-picker-apply" type="button" class="px-3 py-1 text-sm rounded bg-blue-600 text-white ">Ir</button>
                                </div>
                            </div>
                        </div>
                        <!-- Expenses Filter Popover (responsive) -->
                        <div id="expenses-filter-popover" class="hidden fixed z-50 bg-white rounded-xl shadow-2xl border border-gray-200 p-6" style="top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">Filtrar Despesas</h3>
                                <button id="filter-close-btn" class="p-1  rounded-full ">
                                    <span class="material-symbols-outlined text-gray-500">close</span>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pagamento</label>
                                    <select id="filter-payment-method" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Todos os mï¿½todos</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Essencialidade</label>
                                    <select id="filter-spending-type" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Todos os tipos</option>
                                        <option value="essencial">Essencial</option>
                                        <option value="nao-essencial">Nï¿½o Essencial</option>
                                        <option value="reserva">Reserva</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                                    <select id="filter-category" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Todas as categorias</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                                    <select id="filter-type" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Todos</option>
                                        <option value="expense">Despesa</option>
                                        <option value="saving">Reserva</option>
                                    </select>
                                </div>
                                <div class="space-y-3 pt-2 border-t border-gray-200">
                                    <label class="flex items-center gap-3 cursor-pointer  p-2 rounded-lg ">
                                        <input type="checkbox" id="filter-recurring" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" />
                                        <span class="text-sm text-gray-700">Apenas recorrentes</span>
                                    </label>
                                    <label class="flex items-center gap-3 cursor-pointer  p-2 rounded-lg ">
                                        <input type="checkbox" id="filter-installment" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" />
                                        <span class="text-sm text-gray-700">Apenas parceladas/financiamentos</span>
                                    </label>
                                </div>
                                <div class="flex gap-3 pt-4 border-t border-gray-200">
                                    <button id="filter-clear-btn" class="flex-1 px-4 py-2.5 text-sm font-medium rounded-lg border border-gray-300 text-gray-700  ">
                                        Limpar Filtros
                                    </button>
                                    <button id="filter-apply-btn" class="flex-1 px-4 py-2.5 text-sm font-medium rounded-lg bg-blue-600 text-white  ">
                                        Aplicar Filtros
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Backdrop for filter modal -->
                        <div id="filter-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>
                    </div>
                    <button id="next-month-btn" class="p-1.5 rounded-full   ">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                     <button id="today-btn" class="p-1.5 rounded-full   " title="Voltar para o Mï¿½s atual">
                        <span class="material-symbols-outlined">today</span>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Abas de navegaï¿½ï¿½o -->
        <div class="mb-6">
            <div id="tabs" class="flex sm:hidden items-center p-0.5 space-x-1 bg-gray-200 rounded-lg max-w-lg mx-auto">
                 <button data-view="dashboard" class="tab-button w-full py-1.5 text-sm font-semibold text-gray-600 rounded-md ">Visï¿½o Geral</button>
                 <button data-view="credit-cards" class="tab-button w-full py-1.5 text-sm font-semibold text-gray-600 rounded-md ">Faturas</button>
            </div>
        </div>
        
        <main id="app-content">
            <!-- Conteï¿½do da Visï¿½o Geral (Dashboard) -->
            <div id="dashboard-view" class="space-y-8">
                <!-- KPIs Modernos -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="kpi-card kpi-income">
                        <div class="kpi-title">Total de Entradas</div>
                        <div id="kpi-total-income" class="kpi-value">R$ 0,00</div>
                        <div class="kpi-trend">
                            <span class="material-symbols-outlined" style="font-size: 16px;">trending_up</span>
                            <span>Receitas do Mï¿½s</span>
                        </div>
                    </div>
                    <div class="kpi-card kpi-expenses">
                        <div class="kpi-title">Despesas (Pagas)</div>
                        <div id="kpi-total-expenses" class="kpi-value">R$ 0,00</div>
                        <div class="kpi-trend">
                            <span class="material-symbols-outlined" style="font-size: 16px;">trending_down</span>
                            <span>Gastos realizados</span>
                        </div>
                    </div>
                    <div class="kpi-card kpi-savings">
                        <div class="kpi-title">Reservado / Investido</div>
                        <div id="kpi-total-savings" class="kpi-value">R$ 0,00</div>
                        <div class="kpi-trend">
                            <span class="material-symbols-outlined" style="font-size: 16px;">savings</span>
                            <span>Valor poupado</span>
                        </div>
                    </div>
                    <div class="kpi-card kpi-balance">
                        <div class="kpi-title">Saldo Disponï¿½ï¿½vel</div>
                        <div id="kpi-balance" class="kpi-value">R$ 0,00</div>
                        <div class="kpi-trend">
                            <span class="material-symbols-outlined" style="font-size: 16px;">account_balance_wallet</span>
                            <span>Disponï¿½ï¿½vel agora</span>
                        </div>
                    </div>
                </div>
                <!-- Conteï¿½do Principal: Tabelas e Grï¿½ï¿½ficos -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Coluna de TransAï¿½ï¿½ES -->
                    <div class="lg:col-span-2 space-y-8">
                        <!-- MovimentAï¿½ï¿½ES do Mï¿½s header removed; add button moved to header -->

                        <!-- Tabela de Entradas Modernizada -->
                        <div class="modern-card p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-success-100 rounded-lg">
                                        <span class="material-symbols-outlined text-success-600">trending_up</span>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-semibold text-gray-800">Entradas</h2>
                                        <p class="text-sm text-gray-500">Receitas do perï¿½odo atual</p>
                                    </div>
                                </div>
                                <div id="vr-badge" class="modern-badge modern-badge-success"></div>
                            </div>
                            <div class="overflow-x-auto">
                                <table id="income-table" class="modern-table" style="table-layout:fixed; width:100%;">
                                    <colgroup>
                                        <col style="width:48px"> <!-- checkbox -->
                                        <col style="width:auto"> <!-- Descriï¿½ï¿½o -->
                                        <col style="width:140px"> <!-- valor -->
                                        <col style="width:96px"> <!-- Aï¿½ï¿½ES -->
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th class="text-center" style="padding-left: 12px; padding-right: 12px;" title="Confirmado">
                                                <span class="material-symbols-outlined text-gray-400" style="font-size:18px;">done</span>
                                            </th>
                                            <th class="sortable-header text-left" data-sort="description" style="cursor:pointer; padding-left: 12px;">
                                                Descriï¿½ï¿½o <span class="sort-icon material-symbols-outlined"></span>
                                            </th>
                                            <th class="sortable-header text-right" data-sort="amount" style="cursor:pointer; padding-right: 12px;">
                                                Valor <span class="sort-icon material-symbols-outlined"></span>
                                            </th>
                                            <th class="text-center" style="padding-left: 12px; padding-right: 12px;">Aï¿½ï¿½es</th>
                                        </tr>
                                    </thead>
                                    <tbody id="income-table-body"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Tabela de Despesas Modernizada -->
                        <div class="modern-card p-6">
                             <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center gap-3">
                                    <div class="p-2 bg-error-100 rounded-lg">
                                        <span class="material-symbols-outlined text-error-600">trending_down</span>
                                    </div>
                                    <div>
                                        <h2 class="text-xl font-semibold text-gray-800">Despesas</h2>
                                        <p class="text-sm text-gray-500">Gastos do perï¿½ï¿½odo atual</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="modern-input-group" style="width: 200px;">
                                        <span class="modern-input-icon material-symbols-outlined">search</span>
                                        <input type="search" id="search-description" placeholder="Pesquisar despesas..." class="modern-input">
                                    </div>
                                    <button id="expenses-filter-btn" class="modern-btn modern-btn-secondary relative" title="Filtrar despesas">
                                        <span class="material-symbols-outlined">filter_list</span>
                                        <span id="expenses-filter-badge" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-medium leading-none text-white bg-red-600 rounded-full">0</span>
                                    </button>
                                    <!-- Toggle: Agrupar despesas por Descriï¿½ï¿½o -->
                                    <button id="toggle-expense-grouped" class="modern-btn modern-btn-secondary" title="Alternar visï¿½o agrupada">
                                        <span class="material-symbols-outlined">view_module</span>
                                        <span id="toggle-expense-grouped-label">Agrupar</span>
                                    </button>
                                </div>
                             </div>
                             <div class="overflow-x-auto">
                                <table class="modern-table" style="table-layout:fixed; width:100%;">
                                    <colgroup>
                                        <col style="width:48px"> <!-- checkbox -->
                                        <col style="width:auto"> <!-- Descriï¿½ï¿½o -->
                                        <col style="width:130px"> <!-- pagamento -->
                                        <col style="width:130px"> <!-- categoria -->
                                        <col style="width:140px"> <!-- valor -->
                                        <col style="width:96px"> <!-- Aï¿½ï¿½ES -->
                                    </colgroup>
                                    <thead id="expenses-table-head">
                                        <tr>
                                            <th class="text-center" style="padding-left: 12px; padding-right: 12px;" title="Pago">
                                                <span class="material-symbols-outlined text-gray-400" style="font-size:18px;">done</span>
                                            </th>
                                            <th class="sortable-header text-left" data-sort="description" style="cursor:pointer; padding-left: 12px;">
                                                Descriï¿½ï¿½o <span class="sort-icon material-symbols-outlined"></span>
                                            </th>
                                            <th class="sortable-header text-left" data-sort="payment" style="cursor:pointer; padding-left: 12px;">
                                                Pagamento <span class="sort-icon material-symbols-outlined"></span>
                                            </th>
                                            <th class="sortable-header text-left" data-sort="category" style="cursor:pointer; padding-left: 12px;">
                                                Categoria <span class="sort-icon material-symbols-outlined"></span>
                                            </th>
                                            <th class="sortable-header text-right" data-sort="amount" style="cursor:pointer; padding-right: 12px;">
                                                Valor <span class="sort-icon material-symbols-outlined"></span>
                                            </th>
                                            <th class="text-center" style="padding-left: 12px; padding-right: 12px;">Aï¿½ï¿½es</th>
                                        </tr>
                                    </thead>
                                    <tbody id="expenses-table-body"></tbody>
                                </table>
                            </div>
                            <!-- Grouped view container (hidden by default) -->
                            <div id="expenses-grouped-container" class="mt-4 hidden">
                                <div id="expenses-groups" class="expenses-groups"></div>
                            </div>
                        </div>
                        
                        <!-- Tabela de Reservas Modernizada -->
                        <div class="modern-card p-6">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="p-2 bg-primary-100 rounded-lg">
                                    <span class="material-symbols-outlined text-primary-600">savings</span>
                                </div>
                                <div>
                                    <h2 class="text-xl font-semibold text-gray-800">Reservas e Investimentos</h2>
                                    <p class="text-sm text-gray-500">Valores poupados e investidos</p>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="modern-table">
                                    <thead>
                                        <tr>
                                            <th>Descriï¿½ï¿½o</th>
                                            <th>Categoria</th>
                                            <th>Valor</th>
                                            <th style="text-align: right;">Aï¿½ï¿½ES</th>
                                        </tr>
                                    </thead>
                                    <tbody id="savings-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    
                    </div>
                     <!-- Coluna de Grï¿½ï¿½ficos e Insights -->
                    <div class="lg:col-span-1 space-y-8">
                        <!-- Projeï¿½ï¿½es do Mï¿½s -->
                        <div class="modern-card p-4">
                            <div class="flex items-center gap-2 mb-4">
                                <span class="material-symbols-outlined text-primary-600">trending_up</span>
                                <h3 class="font-semibold text-gray-800">Projeï¿½ï¿½es</h3>
                            </div>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <div class="w-2 h-2 bg-success-500 rounded-full"></div>
                                        <span class="text-sm text-gray-600">Saldo Projetado</span>
                                    </div>
                                    <span id="kpi-projected-balance" class="text-base font-semibold text-success-600">R$ 0,00</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <div class="w-2 h-2 bg-error-500 rounded-full"></div>
                                        <span class="text-sm text-gray-600">Despesas Projetadas</span>
                                    </div>
                                    <span id="kpi-projected-expenses" class="text-base font-semibold text-error-600">R$ 0,00</span>
                                </div>
                            </div>
                        </div>
                        <!-- VR KPI: minimal â€” shows available balance and spent progress -->
                        <div id="kpi-vr-card" class="card p-2 rounded-xl mb-2">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-xs font-medium text-gray-500">VR - Uso</h4>
                                </div>
                                <div class="text-right">
                                    <!-- Show available balance (credited - used), same value as the VR card in Faturas -->
                                    <p id="kpi-vr-values" class="text-sm font-semibold text-green-600">R$ 0,00</p>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="w-full bg-gray-200 rounded h-4 overflow-hidden relative">
                                    <div id="kpi-vr-progress" class="h-4 w-0 flex items-center justify-end pr-1 text-xs text-white" ></div>
                                    <div id="kpi-vr-bar-text" class="absolute inset-0 flex items-center justify-center text-xs text-gray-700 pointer-events-none"></div>
                                </div>
                            </div>
                        </div>
                        <!-- VT KPI: mirror VR immediately below -->
                        <div id="kpi-vt-card" class="card p-2 rounded-xl mb-2">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-xs font-medium text-gray-500">VT - Uso</h4>
                                </div>
                                <div class="text-right">
                                    <p id="kpi-vt-values" class="text-sm font-semibold text-yellow-600">R$ 0,00</p>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="w-full bg-gray-200 rounded h-4 overflow-hidden relative">
                                    <div id="kpi-vt-progress" class="h-4 w-0 flex items-center justify-end pr-1 text-xs text-white" ></div>
                                    <div id="kpi-vt-bar-text" class="absolute inset-0 flex items-center justify-center text-xs text-gray-700 pointer-events-none"></div>
                                </div>
                            </div>
                        </div>
                        <div id="feedback-card" class="card p-6 rounded-xl">
                             <h2 class="text-xl font-semibold mb-2">Feedback do Mï¿½s</h2>
                             <p id="feedback-message" class="text-gray-600 text-sm mb-4">...</p>
                             <div id="feedback-visual-container" class="space-y-3"></div>
                        </div>
                        <!-- Metas de Gastos removed per request -->
                        <!-- Grï¿½ï¿½ficos Modernizados -->
                        <div class="modern-chart-container">
                            <div class="modern-chart-header">
                                <div>
                                    <div class="modern-chart-title">
                                        <span class="material-symbols-outlined text-warning-600">pie_chart</span>
                                        Gastos por Categoria
                                    </div>
                                    <div class="modern-chart-subtitle">Distribuiï¿½ï¿½o das despesas por categoria</div>
                                </div>
                            </div>
                            <div class="chart-canvas-wrapper">
                                <div class="h-56"><canvas id="category-spending-chart"></canvas></div>
                            </div>
                        </div>
                        
                        <div class="modern-chart-container">
                            <div class="modern-chart-header">
                                <div>
                                    <div class="modern-chart-title">
                                        <span class="material-symbols-outlined text-primary-600">payment</span>
                                        Gastos por Pagamento
                                    </div>
                                    <div class="modern-chart-subtitle">Anï¿½ï¿½lise por forma de pagamento</div>
                                </div>
                            </div>
                            <div class="chart-canvas-wrapper">
                                <div class="h-56"><canvas id="payment-method-chart"></canvas></div>
                            </div>
                        </div>
                        
                        <div class="modern-chart-container">
                            <div class="modern-chart-header">
                                <div>
                                    <div class="modern-chart-title">
                                        <span class="material-symbols-outlined text-success-600">trending_up</span>
                                        Resumo Anual
                                    </div>
                                    <div class="modern-chart-subtitle">Visï¿½o geral das finanï¿½as do ano</div>
                                </div>
                            </div>
                            <div class="chart-canvas-wrapper">
                                <div class="h-56"><canvas id="annual-summary-chart"></canvas></div>
                            </div>
                        </div>
                        <!-- KPI Percentual de cada despesa do Mï¿½s -->
                        <div class="card p-4 rounded-lg mb-4 bg-gray-50 border border-gray-200">
                            <h3 class="text-sm font-medium text-gray-500 mb-2">Percentual de cada despesa do Mï¿½s</h3>
                            <div id="kpi-expense-percentuals" class="space-y-1"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Conteï¿½do das Faturas de CarTï¿½o -->
            <div id="credit-cards-view" class="hidden">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="credit-cards-container"></div>
            </div>
        </main>
    </div>

    <!-- Modal de transaï¿½ï¿½o Modernizado -->
    <dialog id="transaction-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="transaction-error" class="modern-card p-6 w-full max-w-4xl" style="max-height:98vh;overflow:auto !important;">
        <div class="flex items-center justify-between mb-6 modal-title-row">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-primary-100 rounded-lg">
                    <span class="material-symbols-outlined text-primary-600">receipt_long</span>
                </div>
                <div>
                    <h2 id="modal-title" class="text-2xl font-bold text-gray-800">Nova transaï¿½ï¿½o</h2>
                    <p class="text-sm text-gray-500">Adicione receitas, despesas ou reservas</p>
                </div>
            </div>
            <div style="display:flex;align-items:center;gap:12px">
                <span id="modal-type-indicator" class="modern-badge modern-badge-info"></span>
                <button id="close-transaction-modal" type="button" class="modern-btn modern-btn-secondary" aria-label="Fechar janela de nova transaï¿½ï¿½o">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
        </div>
    <form id="transaction-form" class="space-y-5 text-base mx-auto max-w-3xl">
            <input type="hidden" id="transaction-id">
            <div id="transaction-error" role="alert" aria-live="assertive" aria-atomic="true" class="hidden text-sm text-red-700 bg-red-50 border border-red-100 p-2 rounded">&nbsp;</div>
            <!-- Seletor de Tipo de transaï¿½ï¿½o Modernizado -->
            <div class="bg-gray-50 p-4 rounded-xl mb-6">
                <h3 class="text-sm font-semibold text-gray-700 mb-3">Tipo de transaï¿½ï¿½o</h3>
                <div class="grid grid-cols-3 gap-3">
                    <button type="button" data-type="expenses" class="modal-type-toggle modern-transaction-type flex flex-col items-center p-4 rounded-lg border-2 border-gray-200 bg-white   focus:outline-none group">
                        <div class="p-2 bg-error-100 rounded-lg mb-2 group- ">
                            <span class="material-symbols-outlined text-xl text-error-600">trending_down</span>
                        </div>
                        <span class="text-sm font-semibold text-gray-700">Despesa</span>
                        <span class="text-xs text-gray-500">Gastos realizados</span>
                    </button>
                    <button type="button" data-type="incomes" class="modal-type-toggle modern-transaction-type flex flex-col items-center p-4 rounded-lg border-2 border-gray-200 bg-white   focus:outline-none group">
                        <div class="p-2 bg-success-100 rounded-lg mb-2 group- ">
                            <span class="material-symbols-outlined text-xl text-success-600">trending_up</span>
                        </div>
                        <span class="text-sm font-semibold text-gray-700">Entrada</span>
                        <span class="text-xs text-gray-500">Receitas obtidas</span>
                    </button>
                    <button type="button" data-type="savings" class="modal-type-toggle modern-transaction-type flex flex-col items-center p-4 rounded-lg border-2 border-gray-200 bg-white   focus:outline-none group">
                        <div class="p-2 bg-primary-100 rounded-lg mb-2 group- ">
                            <span class="material-symbols-outlined text-xl text-primary-600">savings</span>
                        </div>
                        <span class="text-sm font-semibold text-gray-700">Reserva</span>
                        <span class="text-xs text-gray-500">Valores poupados</span>
                    </button>
                </div>
            </div>
        
        
            <input type="hidden" id="transaction-type-input" value="expenses">
            <!-- Campos bï¿½sicos Modernizados -->
            <div class="bg-white p-6 rounded-xl border-2 border-gray-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary-600">info</span>
                    InformAï¿½ï¿½ES bï¿½sicas
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="modern-form-group">
                        <label for="description" class="modern-form-label flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary-600">edit_note</span>
                            Descriï¿½ï¿½o
                        </label>
                        <div class="modern-input-group">
                            <input type="text" id="description" required class="modern-input" placeholder="Ex: Supermercado, Salï¿½ï¿½rio..." list="description-suggestions">
                            <datalist id="description-suggestions"></datalist>
                        </div>
                        <p class="modern-form-description">Descreva brevemente a transaï¿½ï¿½o</p>
                        <p id="description-hint" class="text-xs text-gray-500 mt-1 hidden" aria-hidden="true">&nbsp;</p>
                    </div>
                    <div class="modern-form-group">
                        <label for="amount" class="modern-form-label flex items-center gap-2">
                            <span class="material-symbols-outlined text-success-600">attach_money</span>
                            Valor (R$)
                        </label>
                        <div class="modern-input-group">
                            <span class="modern-input-icon">R$</span>
                            <input type="number" id="amount" step="0.01" required class="modern-input" placeholder="0,00">
                        </div>
                        <p class="modern-form-description">Valor da transaï¿½ï¿½o em reais</p>
                    </div>
                </div>
            </div>


            <!-- Campos de Despesas Modernizados -->
            <div id="expense-fields" class="bg-white p-6 rounded-xl border-2 border-error-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-error-600">trending_down</span>
                    Detalhes da Despesa
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="modern-form-group">
                        <label for="payment-method" class="modern-form-label flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary-600">credit_card</span>
                            Forma de Pagamento
                        </label>
                        <div class="modern-input-group">
                            <span class="modern-input-icon material-symbols-outlined">credit_card</span>
                            <select id="payment-method" class="modern-input modern-select">
                            </select>
                        </div>
                        <p class="modern-form-description">Como foi paga a despesa?</p>
                        
                        <!-- DestinaTï¿½ï¿½rio (obrigaTï¿½ï¿½rio para PIX / Transferï¿½ï¿½ncia) -->
                        <div id="payment-recipient-wrapper" class="mt-4 hidden">
                            <label for="payment-recipient" class="modern-form-label flex items-center gap-2">
                                <span class="material-symbols-outlined text-gray-500">person</span>
                                DestinaTï¿½ï¿½rio
                            </label>
                            <div class="modern-input-group">
                                <span class="modern-input-icon material-symbols-outlined">person</span>
                                <input type="text" id="payment-recipient" class="modern-input" placeholder="Nome do destinaTï¿½ï¿½rio">
                            </div>
                            <p id="payment-recipient-hint" class="modern-form-description text-warning-600 hidden">ObrigaTï¿½ï¿½rio para PIX e Transferï¿½ï¿½ncia</p>
                        </div>
                    </div>
                    <div class="modern-form-group">
                        <label for="category-expense" class="modern-form-label flex items-center gap-2">
                            <span class="material-symbols-outlined text-warning-600">category</span>
                            Categoria
                        </label>
                        <div class="modern-input-group">
                            <span class="modern-input-icon material-symbols-outlined">category</span>
                            <select id="category-expense" class="modern-input modern-select"></select>
                        </div>
                        <p class="modern-form-description">Classifique sua despesa para melhor controle</p>
                        <p id="category-hint" class="text-xs text-gray-500 mt-1 hidden" aria-hidden="true">&nbsp;</p>
                    </div>
                </div>
                <div>
                    <label for="expense-type" class="block text-base font-semibold text-gray-700 flex items-center gap-2 modal-tooltip" data-tooltip="Tipo de despesa">
                        <span class="material-symbols-outlined text-blue-400">tune</span>
                        Tipo
                    </label>
                    <select id="expense-type" class="mt-1 block w-full border-2 border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 px-3 py-2 text-base appearance-none">
                        <option value="Essenciais">Essencial</option>
                        <option value="nï¿½o Essenciais">nï¿½o Essencial</option>
                    </select>
                </div>
            </div>

            <div id="saving-fields" class="hidden modal-group space-y-2 bg-gray-50 rounded-xl p-3 shadow-md">
                <div>
                    <label for="category-saving" class="block text-base font-semibold text-gray-700 flex items-center gap-2 modal-tooltip" data-tooltip="Classifique sua reserva">
                        <span class="material-symbols-outlined text-orange-400">category</span>
                        Categoria da Reserva
                    </label>
                    <div class="relative">
                        <span class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-orange-300 pointer-events-none">category</span>
                        <select id="category-saving" class="pl-8 mt-1 block w-full border-2 border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 px-3 py-2 text-base appearance-none"></select>
                    </div>
                </div>
                <!-- goal-selector removed: not functional -->
            </div>

            <!-- opï¿½ï¿½ES Avanï¿½adas -->
            <div id="advanced-options" class="modal-group border-t pt-2 mt-2 space-y-2 bg-gray-50 rounded-xl p-3 shadow-md">
                <div class="option-row">
                    <label class="flex items-center cursor-pointer gap-2 modal-tooltip" data-tooltip="Marque para repetir mensalmente">
                        <input type="checkbox" id="is-recurring" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                        <span class="material-symbols-outlined text-blue-400">autorenew</span>
                        <span class="ml-2 text-base text-gray-700">Tornar esta transaï¿½ï¿½o recorrente? (mensal)</span>
                    </label>
                </div>
                <div class="flex flex-col gap-2 text-base">
                    <!-- opï¿½ï¿½o 'aplicar tambï¿½m ï¿½ï¿½s futuras' removida -->
                    <div class="option-row">
                        <label for="is-installment" class="flex items-center cursor-pointer gap-2 modal-tooltip" data-tooltip="Marque se for uma compra parcelada">
                            <input type="checkbox" id="is-installment" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="material-symbols-outlined text-indigo-400">payments</span>
                            <span class="ml-2 text-base text-gray-700">ï¿½ uma compra parcelada?</span>
                        </label>
                    </div>
                    <div id="installment-fields" class="hidden ml-8 space-y-2 bg-indigo-50 rounded-lg p-3">
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label for="installment-count" class="block text-sm text-gray-700">nï¿½mero de parcelas</label>
                                <input type="number" id="installment-count" min="2" max="48" value="12" class="w-full border rounded px-2 py-1 text-sm" />
                            </div>
                            <div>
                                <label for="installment-start" class="block text-sm text-gray-700">Parcela inicial</label>
                                <input type="number" id="installment-start" min="1" value="1" class="w-full border rounded px-2 py-1 text-sm" />
                            </div>
                        </div>
                        <div class="text-xs text-gray-600">
                            O valor total serï¿½ï¿½ dividido automaticamente em <span id="installment-preview-count">12</span> parcelas de <span id="installment-preview-value" class="font-medium">R$ 0,00</span>
                        </div>
                    </div>
                    <div class="option-row">
                        <label for="is-financing" class="flex items-center cursor-pointer gap-2 modal-tooltip" data-tooltip="Marque se for um financiamento">
                            <input type="checkbox" id="is-financing" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="material-symbols-outlined text-amber-400">account_balance</span>
                            <span class="ml-2 text-base text-gray-700">ï¿½ um financiamento?</span>
                        </label>
                    </div>
                </div>
                <!-- Campos especï¿½ï¿½ficos para Entrada: Salï¿½ï¿½rio (posicionados abaixo da opï¿½ï¿½o recorrente) -->
                <div id="salary-section" class="hidden mt-2 space-y-1 modal-group bg-gray-50 rounded-xl p-3 shadow-md">
                    <label class="flex items-center gap-2 modal-tooltip" data-tooltip="Marque se for salï¿½ï¿½rio">
                        <input type="checkbox" id="is-salary" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                        <span class="material-symbols-outlined text-green-400">work</span>
                        <span class="ml-2 text-base text-gray-700">ï¿½ salï¿½ï¿½rio?</span>
                    </label>
                    <div id="salary-fields" class="hidden">
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                            <div>
                                <label for="salary-base" class="sr-only">Valor bruto do salï¿½ï¿½rio</label>
                                <input type="number" id="salary-base" step="0.01" placeholder="Valor bruto do salï¿½ï¿½rio" title="Valor bruto do salï¿½ï¿½rio" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1">
                            </div>
                            <div>
                                <label for="salary-periculosidade" class="sr-only">Percentual de periculosidade</label>
                                <input type="number" id="salary-periculosidade" step="0.1" placeholder="% Periculosidade" title="Percentual de periculosidade" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1">
                            </div>
                            <div>
                                <label for="salary-outros-proventos" class="sr-only">Outros valores recebidos</label>
                                <input type="number" id="salary-outros-proventos" step="0.01" placeholder="Outros proventos" title="Outros valores recebidos" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1">
                            </div>
                            <div>
                                <label for="salary-dependentes" class="sr-only">nï¿½mero de dependentes</label>
                                <input type="number" id="salary-dependentes" placeholder="Dependentes" title="nï¿½mero de dependentes" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1" min="0">
                            </div>
                            <div>
                                <label for="salary-desjejum-dia" class="sr-only">Valor diï¿½ï¿½rio de desjejum</label>
                                <input type="number" id="salary-desjejum-dia" step="0.01" placeholder="Desjejum (R$/dia)" title="Valor diï¿½ï¿½rio de desjejum" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1">
                            </div>
                            <div>
                                <label for="salary-transporte-dia" class="sr-only">Valor diï¿½ï¿½rio de transporte</label>
                                <input type="number" id="salary-transporte-dia" step="0.01" placeholder="Transporte (R$/dia)" title="Valor diï¿½ï¿½rio de transporte" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1">
                            </div>
                        </div>

                        <details class="mt-2">
                            <summary class="cursor-pointer text-sm text-gray-700">Mais opï¿½ï¿½ES do salï¿½ï¿½rio</summary>
                            <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-1">
                                <div>
                                    <label for="salary-dias-trabalhados" class="sr-only">Dias Trabalhados</label>
                                    <input type="number" id="salary-dias-trabalhados" placeholder="Dias Trabalhados" title="Dias Trabalhados" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1" min="0">
                                </div>
                                <div>
                                    <label for="salary-h-extra-sab" class="sr-only">HE Sï¿½ï¿½b (h)</label>
                                    <input type="number" id="salary-h-extra-sab" step="0.1" placeholder="HE Sï¿½ï¿½b (h)" title="Horas extras sï¿½ï¿½bado (h)" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1" min="0">
                                </div>
                                <div>
                                    <label for="salary-h-extra-dom" class="sr-only">HE Dom (h)</label>
                                    <input type="number" id="salary-h-extra-dom" step="0.1" placeholder="HE Dom (h)" title="Horas extras domingo (h)" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1" min="0">
                                </div>
                                <div>
                                    <label for="salary-jornada-horas" class="sr-only">Jornada (h/Mï¿½s)</label>
                                    <input type="number" id="salary-jornada-horas" step="1" placeholder="Jornada (h/Mï¿½s)" title="Jornada (h/Mï¿½s)" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1" value="220">
                                </div>
                                <div>
                                    <label for="salary-horas-trabalhadas" class="sr-only">Horas trabalhadas (h)</label>
                                    <input type="text" id="salary-horas-trabalhadas" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm py-1" placeholder="Horas trabalhadas (Ex: 117:20)" title="Horas trabalhadas (Ex: 117:20 h:mm)">
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
                <div id="installments-section" class="hidden">
                    <!-- Compact visual for installments & financing (preserve fields/IDs for JS) -->
                    <div class="mt-3">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div id="installments-fields" class="bg-white border border-gray-200 rounded-lg p-3 flex items-start gap-3">
                                <span class="material-symbols-outlined text-indigo-500" style="font-size:28px; margin-top:4px">payments</span>
                                <div class="flex-1">
                                    <div class="text-sm font-semibold text-gray-700">Parcelamento</div>
                                    <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 items-start">
                                        <div>
                                            <label for="installments-count" class="block text-xs text-gray-500 mb-1">Total</label>
                                            <input type="number" id="installments-count" min="2" max="48" class="block w-full sm:w-28 text-center border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Total" title="nï¿½mero de parcelas">
                                        </div>
                                        <div>
                                            <label for="installments-current" class="block text-xs text-gray-500 mb-1">Atual</label>
                                            <input type="number" id="installments-current" min="1" max="48" class="block w-full sm:w-28 text-center border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Atual" title="Parcela atual (se em andamento)">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="financing-fields" class="bg-white border border-gray-200 rounded-lg p-3 flex items-start gap-3">
                                <span class="material-symbols-outlined text-amber-500" style="font-size:28px; margin-top:4px">account_balance</span>
                                <div class="flex-1">
                                    <div class="text-sm font-semibold text-gray-700">Financiamento</div>
                                    <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 items-start">
                                        <div>
                                            <label for="financing-total" class="block text-xs text-gray-500 mb-1">Total</label>
                                            <input type="number" id="financing-total" min="2" max="120" class="block w-full sm:w-28 text-center border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Total" title="Total de parcelas (financiamento)">
                                        </div>
                                        <div>
                                            <label for="financing-current" class="block text-xs text-gray-500 mb-1">Atual</label>
                                            <input type="number" id="financing-current" min="1" max="120" class="block w-full sm:w-28 text-center border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Atual" title="Parcela atual (financiamento)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Modernizado -->
            <div class="flex justify-end mt-8 modal-footer bg-gray-50 -mx-6 -mb-6 p-6 rounded-b-xl border-t border-gray-200">
                <button type="submit" class="modern-btn modern-btn-success px-8 py-3 text-base" id="modal-save-btn">
                    <span class="material-symbols-outlined" id="modal-save-icon">check_circle</span>
                    <span>Salvar transaï¿½ï¿½o</span>
                </button>
            </div>
        
        </form>
    </dialog>

     <dialog id="goal-modal" class="p-8 rounded-2xl shadow-2xl card w-full max-w-lg">
        <h2 id="goal-modal-title" class="text-2xl font-bold mb-6">Nova Meta</h2>
        <form id="goal-form" class="space-y-4">
            <input type="hidden" id="goal-id">
            <div>
                <label for="goal-name" class="block text-sm font-medium text-gray-700">Nome da Meta</label>
                <input type="text" id="goal-name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Ex: Viagem para o Japï¿½o">
            </div>
            <div>
                <label for="goal-amount" class="block text-sm font-medium text-gray-700">Valor Total (R$)</label>
                <input type="number" id="goal-amount" step="0.01" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Ex: 15000">
            </div>
             <div class="flex justify-end gap-4 pt-4">
                <button type="button" id="close-goal-modal-btn" class="bg-gray-200 text-gray-800  font-medium py-2 px-5 rounded-lg ">Cancelar</button>
                <button type="submit" class="btn-primary font-medium py-2 px-5 rounded-lg  ">Salvar Meta</button>
            </div>
        </form>
    </dialog>

    <dialog id="monthly-report-modal" class="report-modal p-8 rounded-2xl shadow-2xl card w-full max-w-4xl overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">RelaTï¿½ï¿½rio Mensal - <span id="monthly-report-title"></span></h2>
            <button type="button" id="close-monthly-report-btn" class="p-2 rounded-full ">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div class="space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card p-4 rounded-lg text-center ">
                    <h3 class="text-sm font-medium text-gray-500">Total Entradas</h3>
                    <p id="mr-total-income" class="text-xl font-semibold text-green-600 mt-1"></p>
                </div>
                 <div class="card p-4 rounded-lg text-center ">
                    <h3 class="text-sm font-medium text-gray-500">Total Saï¿½ï¿½das</h3>
                    <p id="mr-total-outcome" class="text-xl font-semibold text-red-600 mt-1"></p>
                </div>
                 <div class="card p-4 rounded-lg text-center ">
                    <h3 class="text-sm font-medium text-gray-500">Saldo Final</h3>
                    <p id="mr-final-balance" class="text-xl font-semibold mt-1"></p>
                </div>
            </div>
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card p-6 rounded-xl ">
                    <h3 class="text-lg font-semibold mb-4">Onde seu dinheiro foi parar?</h3>
                    <div class="h-64"><canvas id="mr-category-breakdown-chart"></canvas></div>
                </div>
                <div class="card p-6 rounded-xl ">
                    <h3 class="text-lg font-semibold mb-4">Maiores Despesas do Mï¿½s</h3>
                    <ul id="mr-top-expenses-list" class="space-y-2 text-sm"></ul>
                </div>
            </div>
        </div>
    </dialog>

    <dialog id="annual-report-modal" class="report-modal p-8 rounded-2xl shadow-2xl card w-full max-w-4xl overflow-y-auto">
         <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">RelaTï¿½ï¿½rio Anual - <span id="annual-report-title"></span></h2>
            <button type="button" id="close-annual-report-btn" class="p-2 rounded-full ">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
         <div class="space-y-8">
             <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card p-4 rounded-lg text-center ">
                    <h3 class="text-sm font-medium text-gray-500">Total Entradas no Ano</h3>
                    <p id="ar-total-income" class="text-xl font-semibold text-green-600 mt-1"></p>
                </div>
                 <div class="card p-4 rounded-lg text-center ">
                    <h3 class="text-sm font-medium text-gray-500">Total Saï¿½ï¿½das no Ano</h3>
                    <p id="ar-total-outcome" class="text-xl font-semibold text-red-600 mt-1"></p>
                </div>
                 <div class="card p-4 rounded-lg text-center ">
                    <h3 class="text-sm font-medium text-gray-500">Balanï¿½o Final do Ano</h3>
                    <p id="ar-final-balance" class="text-xl font-semibold mt-1"></p>
                </div>
            </div>
             <div class="card p-6 rounded-xl ">
                <h3 class="text-lg font-semibold mb-4">Evoluï¿½ï¿½o do Saldo Mensal</h3>
                <div class="h-80"><canvas id="ar-balance-evolution-chart"></canvas></div>
            </div>
             <div class="card p-6 rounded-xl ">
                <h3 class="text-lg font-semibold mb-4">mï¿½dia de Gastos Mensais por Categoria</h3>
                <div class="h-80"><canvas id="ar-avg-category-spending-chart"></canvas></div>
            </div>
        </div>
    </dialog>

    <!-- VR Ledger Modal -->
    <dialog id="vr-modal" class="p-6 rounded-2xl shadow-2xl card w-full max-w-md">
        <h2 class="text-xl font-bold mb-4">Gerenciar VR</h2>
        <form id="vr-entry-form" class="space-y-3">
            <input type="hidden" id="vr-entry-id">
            <div>
                <label class="block text-sm text-gray-700">Descriï¿½ï¿½o</label>
                <input id="vr-entry-desc" class="mt-1 block w-full border-gray-300 rounded-md p-2" />
            </div>
            <div>
                <label class="block text-sm text-gray-700">Valor (R$)</label>
                <input id="vr-entry-amount" type="number" step="0.01" class="mt-1 block w-full border-gray-300 rounded-md p-2" />
            </div>
            <div class="flex justify-end gap-2 pt-2">
                <button id="vr-entry-cancel" type="button" class="bg-gray-100 px-3 py-1 rounded">Cancelar</button>
                <button id="vr-entry-save" type="submit" class="btn-primary px-3 py-1 rounded">Salvar</button>
            </div>
        </form>
        <button id="close-vr-modal" class="absolute top-3 right-3 p-1"> <span class="material-symbols-outlined">close</span></button>
    </dialog>
    
    <!-- VR Usage Edit Modal -->
    <dialog id="vr-usage-modal" class="p-6 rounded-2xl shadow-2xl card w-full max-w-md">
        <h2 class="text-xl font-bold mb-4">Editar Compra (VR)</h2>
        <form id="vr-usage-form" class="space-y-3">
            <input type="hidden" id="vr-usage-id">
            <div>
                <label class="block text-sm text-gray-700">Descriï¿½ï¿½o</label>
                <input id="vr-usage-desc" class="mt-1 block w-full border-gray-300 rounded-md p-2" />
            </div>
            <div>
                <label class="block text-sm text-gray-700">Valor (R$)</label>
                <input id="vr-usage-amount" type="number" step="0.01" class="mt-1 block w-full border-gray-300 rounded-md p-2" />
            </div>
            <div class="flex justify-end gap-2 pt-2">
                <button id="vr-usage-cancel" type="button" class="bg-gray-100 px-3 py-1 rounded">Cancelar</button>
                <button id="vr-usage-save" type="submit" class="btn-primary px-3 py-1 rounded">Salvar</button>
            </div>
        </form>
        <button id="vr-usage-close" class="absolute top-3 right-3 p-1"> <span class="material-symbols-outlined">close</span></button>
    </dialog>
    
    <!-- VT Ledger Modal -->
    <dialog id="vt-modal" class="p-6 rounded-2xl shadow-2xl card w-full max-w-md">
        <h2 class="text-xl font-bold mb-4">Gerenciar VT</h2>
        <form id="vt-entry-form" class="space-y-3">
            <input type="hidden" id="vt-entry-id">
            <div>
                <label class="block text-sm text-gray-700">Descriï¿½ï¿½o</label>
                <input id="vt-entry-desc" class="mt-1 block w-full border-gray-300 rounded-md p-2" />
            </div>
            <div>
                <label class="block text-sm text-gray-700">Valor (R$)</label>
                <input id="vt-entry-amount" type="number" step="0.01" class="mt-1 block w-full border-gray-300 rounded-md p-2" />
            </div>
            <div class="flex justify-end gap-2 pt-2">
                <button id="vt-entry-cancel" type="button" class="bg-gray-100 px-3 py-1 rounded">Cancelar</button>
                <button id="vt-entry-save" type="submit" class="btn-primary px-3 py-1 rounded">Salvar</button>
            </div>
        </form>
        <button id="close-vt-modal" class="absolute top-3 right-3 p-1"> <span class="material-symbols-outlined">close</span></button>
    </dialog>

    <!-- Salary breakdown modal (step-by-step ilustrative calculation) -->
    <dialog id="salary-breakdown-modal" class="p-6 rounded-2xl shadow-2xl card w-full max-w-2xl">
        <div class="modal-body">
            <div class="flex justify-between items-start mb-4">
                <h3 id="salary-breakdown-title" class="text-lg font-semibold">Detalhamento do Salï¿½ï¿½rio</h3>
                <button id="close-salary-breakdown" class="text-gray-500 ">Fechar âœ•</button>
            </div>
            <div id="salary-breakdown-content" class="space-y-3 text-sm text-gray-700">
                <!-- dynamic content injected by JS -->
            </div>
        </div>
    </dialog>
    
    <!-- VT Usage Edit Modal -->
    <dialog id="vt-usage-modal" class="p-6 rounded-2xl shadow-2xl card w-full max-w-md">
        <h2 class="text-xl font-bold mb-4">Editar Compra (VT)</h2>
        <form id="vt-usage-form" class="space-y-3">
            <input type="hidden" id="vt-usage-id">
            <div>
                <label class="block text-sm text-gray-700">Descriï¿½ï¿½o</label>
                <input id="vt-usage-desc" class="mt-1 block w-full border-gray-300 rounded-md p-2" />
            </div>
            <div>
                <label class="block text-sm text-gray-700">Valor (R$)</label>
                <input id="vt-usage-amount" type="number" step="0.01" class="mt-1 block w-full border-gray-300 rounded-md p-2" />
            </div>
            <div class="flex justify-end gap-2 pt-2">
                <button id="vt-usage-cancel" type="button" class="bg-gray-100 px-3 py-1 rounded">Cancelar</button>
                <button id="vt-usage-save" type="submit" class="btn-primary px-3 py-1 rounded">Salvar</button>
            </div>
        </form>
        <button id="vt-usage-close" class="absolute top-3 right-3 p-1"> <span class="material-symbols-outlined">close</span></button>
    </dialog>
    
    <!-- VT Fuel Detail Modal (Registrar + Histï¿½rico) -->
    <dialog id="vt-fuel-modal" class="p-6 rounded-2xl shadow-2xl card w-full max-w-4xl" style="max-height:92vh;overflow:auto;max-width:900px;">
        <div class="flex items-start justify-between mb-4">
            <h2 class="text-xl font-bold">VT â€” Abastecimentos</h2>
            <div class="flex items-center gap-2">
                <button id="vt-fuel-close" class="p-2 rounded-full " aria-label="Fechar modal"><span class="material-symbols-outlined">close</span></button>
            </div>
        </div>

        <div class="mb-4">
            <div class="flex gap-2">
                <button id="vt-tab-register" class="px-3 py-1 rounded bg-gray-100 font-semibold">Registrar</button>
                <button id="vt-tab-history" class="px-3 py-1 rounded bg-white font-semibold">Histï¿½rico</button>
            </div>
        </div>

        <div id="vt-tab-content">
            <!-- Registrar -->
            <div id="vt-register" class="space-y-3">
                <form id="vt-fuel-form" class="space-y-3">
                    <input type="hidden" id="vt-fuel-id">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700">Veï¿½ï¿½culo</label>
                            <div class="relative select-with-icon">
                                <span class="select-icon material-symbols-outlined">directions_car</span>
                                <select id="vt-fuel-vehicle" class="pl-8 mt-1 block w-full border-gray-300 rounded-md p-2">
                                    <option value="Carro">Carro</option>
                                    <option value="Moto" selected>Moto</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700">Data do abastecimento</label>
                            <div class="relative">
                                <span class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">calendar_today</span>
                                <input id="vt-fuel-date" type="date" class="pl-8 mt-1 block w-full border-gray-300 rounded-md p-2" />
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700">Odï¿½ï¿½metro (km)</label>
                            <div class="relative">
                                <span class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">speed</span>
                                <input id="vt-fuel-odometer" type="number" step="1" class="pl-8 mt-1 block w-full border-gray-300 rounded-md p-2" placeholder="Ex: 12345" />
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700">CombusTï¿½ï¿½vel</label>
                            <div class="relative select-with-icon">
                                <span class="select-icon material-symbols-outlined">local_gas_station</span>
                                <select id="vt-fuel-type" class="pl-8 mt-1 block w-full border-gray-300 rounded-md p-2">
                                    <option value="Gasolina">Gasolina</option>
                                    <option value="Gasolina Aditivada">Gas. Aditivada</option>
                                    <option value="Etanol">Etanol</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700">Preï¿½o / L (R$)</label>
                            <div class="relative">
                                <span class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">attach_money</span>
                                <input id="vt-fuel-price" type="text" class="pl-8 mt-1 block w-full border-gray-300 rounded-md p-2" placeholder="Ex: 5,49" />
                            </div>
                            <p id="vt-error-price" class="text-xs text-red-600 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700">Litros (L)</label>
                            <div class="relative">
                                <span class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">opacity</span>
                                <input id="vt-fuel-liters" type="text" class="pl-8 mt-1 block w-full border-gray-300 rounded-md p-2" placeholder="Ex: 30,0" />
                            </div>
                            <p id="vt-error-liters" class="text-xs text-red-600 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700">Valor total (R$)</label>
                            <div class="relative">
                                <span class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">payments</span>
                                <input id="vt-fuel-total" type="text" class="pl-8 mt-1 block w-full border-gray-300 rounded-md p-2" placeholder="Ex: 164,70" />
                            </div>
                            <p id="vt-error-total" class="text-xs text-red-600 hidden"></p>
                        </div>
                    </div>

                    <p id="vt-fuel-hint" class="text-xs text-gray-500">Estes dados serï¿½o usados para relaTï¿½ï¿½rios de consumo, autonomia e Histï¿½rico de preï¿½os.</p>

                    <div class="flex justify-end gap-2 pt-2">
                        <button id="vt-fuel-cancel" type="button" class="bg-gray-100 px-3 py-1 rounded">Cancelar</button>
                        <button id="vt-fuel-save" type="submit" class="btn-primary px-3 py-1 rounded" disabled>Salvar Abastecimento</button>
                    </div>
                </form>
            </div>

            <!-- Histï¿½rico (hidden por padrï¿½o, mostrado pela aba) -->
            <div id="vt-history" class="hidden">
                <div class="flex flex-col md:flex-row md:items-center md:gap-4 mb-3">
                    <div class="flex gap-2 items-center flex-1">
                        <label class="text-sm text-gray-600">Veï¿½ï¿½culo</label>
                        <div class="relative select-with-icon">
                            <span class="select-icon material-symbols-outlined">directions_car</span>
                            <select id="vt-filter-vehicle" class="pl-8 border-gray-200 rounded p-1"></select>
                        </div>
                        <label class="text-sm text-gray-600 ml-3">CombusTï¿½ï¿½vel</label>
                        <div class="relative select-with-icon">
                            <span class="select-icon material-symbols-outlined">local_gas_station</span>
                            <select id="vt-filter-fuel" class="pl-8 border-gray-200 rounded p-1">
                                <option value="">Todos</option>
                                <option value="Gasolina">Gasolina</option>
                                <option value="Gasolina Aditivada">Gas. Aditivada</option>
                                <option value="Etanol">Etanol</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 mt-2 md:mt-0">
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">search</span>
                            <input id="vt-filter-search" class="pl-8 border-gray-200 rounded p-1" placeholder="Pesquisar Descriï¿½ï¿½o..." />
                        </div>
                        <button id="vt-filter-clear" class="bg-gray-100 px-2 py-1 rounded">Limpar</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
                    <div class="p-3 rounded bg-white border">
                        <div class="text-sm text-gray-500">Total Gasto</div>
                        <div id="vt-stat-total" class="text-lg font-semibold">R$ 0,00</div>
                    </div>
                    <div class="p-3 rounded bg-white border">
                        <div class="text-sm text-gray-500">Total Litros</div>
                        <div id="vt-stat-liters" class="text-lg font-semibold">0.00 L</div>
                    </div>
                    <div class="p-3 rounded bg-white border">
                        <div class="text-sm text-gray-500">mï¿½dia Preï¿½o/L</div>
                        <div id="vt-stat-avgprice" class="text-lg font-semibold">R$ 0,00</div>
                    </div>
                </div>

                <div class="p-3 rounded bg-white border mb-3">
                    <div class="text-sm text-gray-500">Autonomia (mï¿½dia km/L calculada a partir de odï¿½ï¿½metros)</div>
                    <div id="vt-stat-autonomy" class="text-lg font-semibold">â€”</div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-3">
                    <div class="p-3 rounded bg-white border">
                        <div class="text-sm text-gray-500 mb-2">Histï¿½rico de Preï¿½o / L</div>
                        <canvas id="vt-chart-price" height="160"></canvas>
                    </div>
                    <div class="p-3 rounded bg-white border">
                        <div class="text-sm text-gray-500 mb-2">Autonomia por intervalo (km/L)</div>
                        <canvas id="vt-chart-autonomy" height="160"></canvas>
                    </div>
                </div>

                <div class="overflow-auto max-h-64 rounded border bg-white p-2">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="text-left text-xs text-gray-500">
                                <th class="px-2 py-1">Data</th>
                                <th class="px-2 py-1">Descriï¿½ï¿½o</th>
                                <th class="px-2 py-1">Veï¿½ï¿½culo</th>
                                <th class="px-2 py-1">Km</th>
                                <th class="px-2 py-1">L</th>
                                <th class="px-2 py-1">R$ / L</th>
                                <th class="px-2 py-1">Total</th>
                                <th class="px-2 py-1 text-right">&nbsp;</th>
                            </tr>
                        </thead>
                        <tbody id="vt-history-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </dialog>
    </div> <!-- Fim do mainApp -->

    
    
    
    <!-- Toasts -->
    <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded shadow-lg hidden" style="z-index: 2147483647 !important;" role="status" aria-live="polite"></div>
    <!-- Confirm Modal (generic) -->
    <dialog id="confirm-dialog" class="p-4 rounded-2xl shadow-2xl card w-full max-w-md">
        <div class="mb-3">
            <h3 id="confirm-dialog-title" class="text-lg font-semibold">Confirmar</h3>
        </div>
        <div id="confirm-dialog-body" class="text-sm text-gray-700 mb-4">Tem certeza?</div>
        <div class="flex justify-end gap-2">
            <button id="confirm-dialog-cancel" class="px-3 py-1 rounded bg-gray-100">Cancelar</button>
            <button id="confirm-dialog-ok" class="px-3 py-1 rounded bg-red-600 text-white">Excluir</button>
        </div>
    </dialog>
    
    <!-- Mobile Bottom Navigation -->
    <nav id="mobile-bottom-nav" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-white rounded-full shadow-lg px-3 py-2 z-50 gap-3 hidden">
        <button data-view="dashboard" class="mobile-nav-btn p-2 rounded-full" title="Visï¿½o Geral"><span class="material-symbols-outlined">dashboard</span></button>
        <button data-view="credit-cards" class="mobile-nav-btn p-2 rounded-full" title="Faturas"><span class="material-symbols-outlined">credit_card</span></button>
    </nav>
    <!-- Mobile Action Sheet (hidden until FAB tapped) -->
    <div id="mobile-action-sheet" class="hidden fixed inset-x-0 bottom-0 z-60 flex items-end justify-center">
        <div id="mas-backdrop" style="position:fixed;inset:0;background:rgba(0,0,0,0.4);" aria-hidden="true"></div>
        <div id="mas-sheet" role="dialog" aria-modal="true" class="w-full max-w-2xl bg-white rounded-t-xl shadow-2xl p-4" >
            <div class="sheet-handle" style="width:56px;height:6px;background:#e5e7eb;border-radius:999px;margin:6px auto 10px;"></div>
            <div class="grid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;">
                <button id="mas-new-transaction" class="mobile-sheet-btn" style="padding:14px;border-radius:12px;background:linear-gradient(180deg,#06b6d4,#0369a1);color:#fff;font-weight:600;">Nova transaï¿½ï¿½o</button>
                <button id="mas-new-income" class="mobile-sheet-btn" style="padding:14px;border-radius:12px;background:linear-gradient(180deg,#10b981,#059669);color:#fff;font-weight:600;">Nova receita</button>
                <button id="mas-new-expense" class="mobile-sheet-btn" style="padding:14px;border-radius:12px;background:linear-gradient(180deg,#f97316,#dc2626);color:#fff;font-weight:600;">Nova despesa</button>
                <button id="mas-import" class="mobile-sheet-btn" style="padding:14px;border-radius:12px;background:#f3f4f6;color:#111;font-weight:600;">Importar planilha</button>
            </div>
            <div style="margin-top:12px;text-align:center;"><button id="mas-cancel" style="padding:10px 14px;border-radius:10px;background:#fff;border:1px solid #e5e7eb;">Fechar</button></div>
        </div>
    </div>
    <!-- Mobile Floating Add Transaction Button -->
    <button id="mobile-add-transaction-fab" aria-label="Adicionar transaï¿½ï¿½o" title="Nova transaï¿½ï¿½o">+
    </button>

    <!-- Mobile-only enhancements: CSS + JS (do not change desktop) -->
    <style id="mobile-enhancements">
    /* Scope to small screens only so desktop is unchanged */
    @media (max-width: 768px) {
        /* Gentle global typography scaling and spacing for mobile */
        html, body { font-size: 16px !important; -webkit-font-smoothing:antialiased; }
        body { padding-bottom: 6.5rem !important; /* avoid bottom nav overlap */ }

        /* Make main layout use full viewport width with comfortable horizontal padding */
        /* Target common wrapper/container names; these selectors are safe because they're scoped to mobile only */
        .container, .app-container, .main, .content, .page, .panel, .wrap, #app {
            width: calc(100vw - 1.5rem) !important;
            max-width: calc(100vw - 1.5rem) !important;
            margin-left: auto !important;
            margin-right: auto !important;
            padding-left: 0.75rem !important;
            padding-right: 0.75rem !important;
        }

        /* Make bottom nav more prominent and finger-friendly */
        #mobile-bottom-nav {
            display: flex !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            bottom: 0.8rem !important;
            padding: 0.45rem 0.75rem !important;
            gap: 8px !important;
            border-radius: 9999px !important;
            box-shadow: none;
            z-index: 140000 !important;
        }
        #mobile-bottom-nav .mobile-nav-btn { width:48px; height:48px; display:inline-flex; align-items:center; justify-content:center; }

        /* Floating action button: larger, high-contrast, positioned above bottom-nav with smooth shadow */
        #mobile-add-transaction-fab {
            display: inline-flex !important;
            position: fixed !important;
            right: 1rem !important;
            bottom: 5.8rem !important; /* above bottom nav */
            width: 64px !important;
            height: 64px !important;
            border-radius: 9999px !important;
            background: linear-gradient(180deg,#06b6d4,#0369a1) !important;
            color: #fff !important;
            font-size: 34px !important;
            align-items: center !important;
            justify-content: center !important;
            box-shadow: none;
            z-index: 150000 !important;
            border: none !important;
            -webkit-tap-highlight-color: transparent;
            
        }
        #mobile-add-transaction-fab:active {  box-shadow: none; }

        /* Mobile action sheet styles */
        #mobile-action-sheet { display: none; }
        #mobile-action-sheet.show { display: flex; }

        /* Make modal dialogs full-screen and easier to scroll on mobile */
        dialog[open] {
            width: 100vw !important;
            height: 100vh !important;
            left: 0 !important;
            right: 0 !important;
            top: 0 !important;
            bottom: 0 !important;
            margin: 0 !important;
            border-radius: 12px !important;
            padding: 0.75rem !important;
            overflow: auto !important;
            -webkit-overflow-scrolling: touch !important;
            display: flex !important; flex-direction: column !important;
        }
        dialog::backdrop { background: rgba(0,0,0,0.6) !important; }
        dialog .modal-body, dialog .dialog-body, dialog .content { width: calc(100vw - 2rem) !important; margin: 0 auto !important; }

    /* Keep cards and panels full-bleed where intended, but keep tables as normal rows to avoid horizontal scroll on mobile */
    .dashboard-card, .fatura-card, .transaction-card, .card, .panel { width: calc(100vw - 1.5rem) !important; max-width: calc(100vw - 1.5rem) !important; margin: 0.6rem auto !important; border-radius: 12px !important; box-shadow: none; padding: 12px !important; background: linear-gradient(180deg,#ffffff,#fbfbff); }

    /* Tables: keep natural table layout (rows stacked vertically). Use subtle dividers between rows for mobile readability. */
    .responsive-table, .responsive-table table { width: 100% !important; max-width: 100% !important; }
    /* Prevent fixed col widths from forcing horizontal scroll on mobile */
    .responsive-table colgroup col { width: auto !important; }
    .responsive-table tr { display: table-row !important; margin: 0 !important; border-radius: 0 !important; background: transparent !important; box-shadow: none; padding: 0 !important; }
    .responsive-table td { display: table-cell !important; vertical-align: middle !important; padding: 10px 8px !important; border: none !important; border-bottom: 1px solid rgba(0,0,0,0.06) !important; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .responsive-table td .material-symbols-outlined { margin-right: 8px !important; }

        /* Forms and inputs take full width like the transaction modal */
        form, .form-row, .field, .form-group { width: calc(100vw - 2rem) !important; max-width: calc(100vw - 2rem) !important; margin: 0.4rem auto !important; }
        input, select, textarea, .select-wrapper, .icon-select-button { display: block !important; width: 100% !important; box-sizing: border-box !important; font-size: 16px !important; padding: 12px !important; border-radius: 10px !important; }
        label { display:block; margin-bottom:6px; color:#374151; font-weight:600; }
        .field small, .hint { display:block; color:#6b7280; margin-top:6px; }

        /* Buttons full width in dialogs and action groups */
        .modal-actions, .dialog-actions, .action-row { display:flex; flex-direction:column; gap:10px; }
        .modal-actions button, .dialog-actions button, .modal-action-btn { width:100% !important; }

        /* Dashboard compactness and legibility */
        .dashboard-grid { grid-template-columns: 1fr !important; gap: 10px !important; }

        /* Compact, tappable action buttons and inputs */
        .actions-cell button { min-width: 48px !important; height:48px !important; }
        input, select, textarea { font-size: 16px !important; padding: 12px !important; }

        /* Improve focus outlines for keyboard and accessibility on mobile */
        :focus { outline: 3px solid rgba(6, 182, 212, 0.18); outline-offset: 3px; }
    }
    </style>

    
    <!-- Swipe-to-reveal behavior removed: rows are standard table rows with inline action buttons -->

    <!-- ===== MICROINTERAï¿½ï¿½ES E MELHORIAS UX ===== -->

    
</body>
</html>

<!-- Main Application Script (Development) -->
<script src="src/js/app.js"></script>
<!-- ES6 Modules (Development) -->
<script type="module" src="src/js/modules.js"></script>
</body>
</html>
